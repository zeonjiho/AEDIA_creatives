import React, { useState, useEffect } from 'react';
import styles from './Contact.module.css';
import { 
  HiSearch, HiUser, HiUserGroup, HiPhone, HiMail, 
  HiOfficeBuilding, HiClock, HiTag, HiDocument,
  HiViewGrid, HiViewList
} from 'react-icons/hi';

// Ïä§ÌÉ≠ Îç∞Ïù¥ÌÑ∞ (StaffSearchModalÏóêÏÑú Í∞ÄÏ†∏Ïò® Îç∞Ïù¥ÌÑ∞)
const allStaffData = [
  { id: 1, name: 'ÍπÄÏó∞Ï∂ú', type: 'staff', position: 'Ïó∞Ï∂ú', department: 'Ïó∞Ï∂úÎ∂Ä', experience: '5ÎÖÑ', phone: '010-1234-5678', email: 'kim.director@example.com' },
  { id: 2, name: 'Ïù¥Ï°∞Ïó∞Ï∂ú', type: 'staff', position: 'Ï°∞Ïó∞Ï∂ú', department: 'Ïó∞Ï∂úÎ∂Ä', experience: '3ÎÖÑ', phone: '010-2345-6789', email: 'lee.ad@example.com' },
  { id: 3, name: 'Î∞ïÏ†úÏûë', type: 'staff', position: 'Ï†úÏûë PD', department: 'Ï†úÏûëÎ∂Ä', experience: '7ÎÖÑ', phone: '010-3456-7890', email: 'park.pd@example.com' },
  { id: 4, name: 'ÏµúÏ¥¨Í∞ê', type: 'staff', position: 'Ï¥¨ÏòÅÍ∞êÎèÖ', department: 'Ï¥¨ÏòÅÎ∂Ä', experience: '8ÎÖÑ', phone: '010-4567-8901', email: 'choi.dop@example.com' },
  { id: 5, name: 'Ï†ïÏ°∞Î™Ö', type: 'staff', position: 'Ï°∞Î™ÖÍ∞êÎèÖ', department: 'Ï°∞Î™ÖÎ∂Ä', experience: '6ÎÖÑ', phone: '010-5678-9012', email: 'jung.gaffer@example.com' },
  { id: 6, name: 'Í∞ïÎØ∏Í∞ê', type: 'staff', position: 'ÎØ∏Ïà†Í∞êÎèÖ', department: 'ÎØ∏Ïà†Î∂Ä', experience: '4ÎÖÑ', phone: '010-6789-0123', email: 'kang.pd@example.com' },
  { id: 7, name: 'Ïú§ÏßÄÎØ∏Ïßë', type: 'staff', position: 'ÏßÄÎØ∏Ïßë', department: 'ÎØ∏Ïà†Î∂Ä', experience: '2ÎÖÑ', phone: '010-7890-1234', email: 'yoon.jimmy@example.com' },
  { id: 8, name: 'ÏûÑCG', type: 'staff', position: 'CG', department: 'VFXÎ∂Ä', experience: '5ÎÖÑ', phone: '010-8901-2345', email: 'lim.cg@example.com' },
  { id: 9, name: 'ÌôçÌÅ¥Î¶¨Îãù', type: 'staff', position: 'ÌÅ¥Î¶¨Îãù', department: 'ÌõÑÎ∞òÎ∂Ä', experience: '3ÎÖÑ', phone: '010-9012-3456', email: 'hong.clean@example.com' },
  { id: 10, name: 'ÏÜ°DI', type: 'staff', position: 'DI', department: 'ÌõÑÎ∞òÎ∂Ä', experience: '4ÎÖÑ', phone: '010-0123-4567', email: 'song.di@example.com' },
  { id: 11, name: 'ÍπÄÏßÅÏõê1', type: 'employee', position: 'ÌîÑÎ°úÎìÄÏÑú', department: 'Ï†úÏûëÌåÄ', email: 'kim@company.com', phone: '010-1111-2222' },
  { id: 12, name: 'Ïù¥ÏßÅÏõê2', type: 'employee', position: 'Îß§ÎãàÏ†Ä', department: 'Í∏∞ÌöçÌåÄ', email: 'lee@company.com', phone: '010-2222-3333' },
  { id: 13, name: 'Î∞ïÏßÅÏõê3', type: 'employee', position: 'ÎîîÏûêÏù¥ÎÑà', department: 'ÎîîÏûêÏù∏ÌåÄ', email: 'park@company.com', phone: '010-3333-4444' },
  { id: 14, name: 'ÏµúÏßÅÏõê4', type: 'employee', position: 'Í∞úÎ∞úÏûê', department: 'Í∞úÎ∞úÌåÄ', email: 'choi@company.com', phone: '010-4444-5555' },
  { id: 15, name: 'Ï†ïÏßÅÏõê5', type: 'employee', position: 'ÎßàÏºÄÌÑ∞', department: 'ÎßàÏºÄÌåÖÌåÄ', email: 'jung@company.com', phone: '010-5555-6666' },
];

const Contact = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [typeFilter, setTypeFilter] = useState('all');
  const [positionFilter, setPositionFilter] = useState('all');
  const [filteredStaff, setFilteredStaff] = useState(allStaffData);
  const [currentTime, setCurrentTime] = useState(new Date());
  const [viewMode, setViewMode] = useState('card'); // 'card' ÎòêÎäî 'list'

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);
    
    return () => clearInterval(timer);
  }, []);

  useEffect(() => {
    let filtered = allStaffData;

    // ÌÉÄÏûÖ ÌïÑÌÑ∞ÎßÅ
    if (typeFilter !== 'all') {
      filtered = filtered.filter(person => person.type === typeFilter);
    }

    // ÏßÅÏ±Ö ÌïÑÌÑ∞ÎßÅ
    if (positionFilter !== 'all') {
      filtered = filtered.filter(person => person.position === positionFilter);
    }

    // Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
    if (searchTerm) {
      filtered = filtered.filter(person => 
        person.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        person.position.toLowerCase().includes(searchTerm.toLowerCase()) ||
        person.department.toLowerCase().includes(searchTerm.toLowerCase()) ||
        (person.phone && person.phone.includes(searchTerm)) ||
        (person.email && person.email.toLowerCase().includes(searchTerm.toLowerCase()))
      );
    }

    setFilteredStaff(filtered);
  }, [searchTerm, typeFilter, positionFilter]);

  // Í≥†Ïú† ÏßÅÏ±Ö Î™©Î°ù ÏÉùÏÑ±
  const uniquePositions = [...new Set(allStaffData.map(person => person.position))];

  const getTypeText = (type) => {
    return type === 'staff' ? 'Ïô∏Î∂Ä Ïä§ÌÉ≠' : 'ÎÇ¥Î∂Ä ÏßÅÏõê';
  };

  const getTypeClass = (type) => {
    return type === 'staff' ? styles.type_staff : styles.type_employee;
  };

  // Ïπ¥ÎìúÎ∑∞ Î†åÎçîÎßÅ
  const renderCardView = () => (
    <div className={styles.staff_grid}>
      {filteredStaff.length === 0 ? (
        <div className={styles.no_results}>
          <HiDocument />
          <p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
        </div>
      ) : (
        filteredStaff.map(person => (
          <div key={person.id} className={styles.staff_card}>
            <div className={styles.card_header}>
              <div className={styles.person_avatar}>
                {person.name.charAt(0)}
              </div>
              <div className={styles.person_basic}>
                <h3 className={styles.person_name}>{person.name}</h3>
                <span className={`${styles.person_type} ${getTypeClass(person.type)}`}>
                  {getTypeText(person.type)}
                </span>
              </div>
            </div>
            
            <div className={styles.card_content}>
              <div className={styles.info_item}>
                <HiTag className={styles.info_icon} />
                <span className={styles.info_label}>ÏßÅÏ±Ö:</span>
                <span className={styles.info_value}>{person.position}</span>
              </div>
              
              <div className={styles.info_item}>
                <HiOfficeBuilding className={styles.info_icon} />
                <span className={styles.info_label}>Î∂ÄÏÑú:</span>
                <span className={styles.info_value}>{person.department}</span>
              </div>
              
              {person.experience && (
                <div className={styles.info_item}>
                  <HiClock className={styles.info_icon} />
                  <span className={styles.info_label}>Í≤ΩÎ†•:</span>
                  <span className={styles.info_value}>{person.experience}</span>
                </div>
              )}
              
              {person.phone && (
                <div className={styles.info_item}>
                  <HiPhone className={styles.info_icon} />
                  <span className={styles.info_label}>Ïó∞ÎùΩÏ≤ò:</span>
                  <a href={`tel:${person.phone}`} className={styles.contact_link}>
                    {person.phone}
                  </a>
                </div>
              )}
              
              {person.email && (
                <div className={styles.info_item}>
                  <HiMail className={styles.info_icon} />
                  <span className={styles.info_label}>Ïù¥Î©îÏùº:</span>
                  <a href={`mailto:${person.email}`} className={styles.contact_link}>
                    {person.email}
                  </a>
                </div>
              )}
            </div>
          </div>
        ))
      )}
    </div>
  );

  // Î¶¨Ïä§Ìä∏Î∑∞ Î†åÎçîÎßÅ
  const renderListView = () => (
    <div className={styles.staff_list}>
      {filteredStaff.length === 0 ? (
        <div className={styles.no_results}>
          <HiDocument />
          <p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
        </div>
      ) : (
        <div className={styles.list_container}>
          {/* Î¶¨Ïä§Ìä∏ Ìó§Îçî */}
          <div className={styles.list_header}>
            <div className={styles.list_header_cell}>Ïù¥Î¶Ñ</div>
            <div className={styles.list_header_cell}>ÏßÅÏ±Ö</div>
            <div className={styles.list_header_cell}>Î∂ÄÏÑú</div>
            <div className={styles.list_header_cell}>Í≤ΩÎ†•</div>
            <div className={styles.list_header_cell}>Ïó∞ÎùΩÏ≤ò</div>
            <div className={styles.list_header_cell}>Ïù¥Î©îÏùº</div>
          </div>
          
          {/* Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖúÎì§ */}
          <div className={styles.list_body}>
            {filteredStaff.map(person => (
              <div key={person.id} className={styles.list_item}>
                <div className={styles.list_cell}>
                  <div className={styles.list_person_info}>
                    <div className={styles.list_avatar}>
                      {person.name.charAt(0)}
                    </div>
                    <div className={styles.list_name_section}>
                      <span className={styles.list_person_name}>{person.name}</span>
                      <span className={`${styles.list_person_type} ${getTypeClass(person.type)}`}>
                        {getTypeText(person.type)}
                      </span>
                      <div className={styles.mobile_contact_info}>
                        <span className={styles.mobile_contact_item}>
                          {person.position} ‚Ä¢ {person.department}
                          {person.experience && ` ‚Ä¢ ${person.experience}`}
                        </span>
                        {person.phone && (
                          <a href={`tel:${person.phone}`} className={styles.mobile_contact_link}>
                            üìû {person.phone}
                          </a>
                        )}
                        {person.email && (
                          <a href={`mailto:${person.email}`} className={styles.mobile_contact_link}>
                            ‚úâÔ∏è {person.email}
                          </a>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
                <div className={styles.list_cell}>{person.position}</div>
                <div className={styles.list_cell}>{person.department}</div>
                <div className={styles.list_cell}>{person.experience || '-'}</div>
                <div className={styles.list_cell}>
                  {person.phone ? (
                    <a href={`tel:${person.phone}`} className={styles.contact_link}>
                      {person.phone}
                    </a>
                  ) : '-'}
                </div>
                <div className={styles.list_cell}>
                  {person.email ? (
                    <a href={`mailto:${person.email}`} className={styles.contact_link}>
                      {person.email}
                    </a>
                  ) : '-'}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );

  return (
    <div className={styles.container}>
      {/* Ìó§Îçî */}
      <header className={styles.dashboard_header}>
        <div className={styles.header_content}>
          <h1 className={styles.dashboard_title}>Contact Directory</h1>
          <p className={styles.dashboard_date}>
            {currentTime.toLocaleDateString('ko-KR', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })} {currentTime.toLocaleTimeString('ko-KR')}
          </p>
        </div>
        
        <div className={styles.header_controls}>
          <div className={styles.view_controls}>
            <div className={styles.view_toggle_group}>
              <button 
                className={`${styles.view_toggle_btn} ${viewMode === 'card' ? styles.active : ''}`}
                onClick={() => setViewMode('card')}
                title="Ïπ¥ÎìúÎ∑∞"
              >
                <HiViewGrid />
              </button>
              <button 
                className={`${styles.view_toggle_btn} ${viewMode === 'list' ? styles.active : ''}`}
                onClick={() => setViewMode('list')}
                title="Î¶¨Ïä§Ìä∏Î∑∞"
              >
                <HiViewList />
              </button>
            </div>
          </div>
          <div className={styles.stats_info}>
            <span className={styles.stats_item}>
              <HiUser /> {allStaffData.filter(p => p.type === 'staff').length}Î™Ö Ïô∏Î∂Ä Ïä§ÌÉ≠
            </span>
            <span className={styles.stats_item}>
              <HiUserGroup /> {allStaffData.filter(p => p.type === 'employee').length}Î™Ö ÎÇ¥Î∂Ä ÏßÅÏõê
            </span>
          </div>
        </div>
      </header>

      {/* Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ */}
      <div className={styles.search_controls}>
        <div className={styles.search_bar}>
          <HiSearch className={styles.search_icon} />
          <input
            type="text"
            placeholder="Ïù¥Î¶Ñ, ÏßÅÏ±Ö, Î∂ÄÏÑú, Ïó∞ÎùΩÏ≤òÎ°ú Í≤ÄÏÉâ..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className={styles.search_input}
          />
        </div>
        
        <div className={styles.filters}>
          {/* ÌÉÄÏûÖ ÌïÑÌÑ∞ */}
          <div className={styles.filter_group}>
            <button 
              className={`${styles.filter_tab} ${typeFilter === 'all' ? styles.active : ''}`}
              onClick={() => setTypeFilter('all')}
            >
              Ï†ÑÏ≤¥
            </button>
            <button 
              className={`${styles.filter_tab} ${typeFilter === 'staff' ? styles.active : ''}`}
              onClick={() => setTypeFilter('staff')}
            >
              <HiUser /> Ïô∏Î∂Ä Ïä§ÌÉ≠
            </button>
            <button 
              className={`${styles.filter_tab} ${typeFilter === 'employee' ? styles.active : ''}`}
              onClick={() => setTypeFilter('employee')}
            >
              <HiUserGroup /> ÎÇ¥Î∂Ä ÏßÅÏõê
            </button>
          </div>

          {/* ÏßÅÏ±Ö ÌïÑÌÑ∞ */}
          <div className={styles.filter_group}>
            <select 
              value={positionFilter} 
              onChange={(e) => setPositionFilter(e.target.value)}
              className={styles.position_select}
            >
              <option value="all">Î™®Îì† ÏßÅÏ±Ö</option>
              {uniquePositions.map(position => (
                <option key={position} value={position}>{position}</option>
              ))}
            </select>
          </div>
        </div>
      </div>

      {/* Ïä§ÌÉ≠ Î™©Î°ù - Î∑∞ Î™®ÎìúÏóê Îî∞Îùº Î†åÎçîÎßÅ */}
      {viewMode === 'card' ? renderCardView() : renderListView()}

      {/* Í≤∞Í≥º ÏöîÏïΩ */}
      {filteredStaff.length > 0 && (
        <div className={styles.results_summary}>
          Ï¥ù {filteredStaff.length}Î™ÖÏùò Ïó∞ÎùΩÏ≤òÍ∞Ä ÌëúÏãúÎêòÍ≥† ÏûàÏäµÎãàÎã§.
        </div>
      )}
    </div>
  );
};

export default Contact; 